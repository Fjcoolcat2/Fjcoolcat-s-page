<!-- Add this inside the admin-controls div, after the "Add to Shop" button -->
<div class="form-group" style="display: flex; align-items: end;">
    <button class="btn-primary" onclick="toggleRolePanel()" style="width: 100%; background: linear-gradient(135deg, #9c27b0, #6a1b9a);">ðŸ‘¥ Role Manager</button>
</div>

<!-- Add this new section after the admin-controls div -->
<div id="roleManagerPanel" class="role-manager" style="display: none;">
    <div class="role-manager-header">
        <h3>ðŸ‘¥ User Role Manager</h3>
        <button class="close-role-panel" onclick="toggleRolePanel()">Ã—</button>
    </div>
    
    <div class="role-search-section">
        <input type="text" id="userSearchInput" placeholder="Search users..." onkeyup="searchUsers()">
        <div class="role-filter-buttons">
            <button class="role-filter-btn active" onclick="filterRole('all')">All Users</button>
            <button class="role-filter-btn" onclick="filterRole('buyer')">Buyers</button>
            <button class="role-filter-btn" onclick="filterRole('massive')">Massive Buyers</button>
            <button class="role-filter-btn" onclick="filterRole('rich')">Really Rich</button>
            <button class="role-filter-btn" onclick="filterRole('friend')">Friends</button>
        </div>
    </div>
    
    <div id="userListContainer" class="user-list-container">
        <!-- Users will be populated here -->
    </div>
</div>

<!-- Add the CSS for the role manager -->
<style>
.role-manager {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 215, 0, 0.2);
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 40px;
    animation: slideDown 0.5s ease;
}

.role-manager-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(255, 215, 0, 0.2);
}

.role-manager-header h3 {
    font-family: 'Cinzel', serif;
    color: var(--gold-primary);
    font-size: 1.5rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.close-role-panel {
    background: rgba(255, 82, 82, 0.2);
    color: #ff5252;
    border: 2px solid rgba(255, 82, 82, 0.5);
    width: 35px;
    height: 35px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1.3rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
}

.close-role-panel:hover {
    background: rgba(255, 82, 82, 0.4);
    color: #fff;
    transform: rotate(90deg);
}

.role-search-section {
    margin-bottom: 25px;
}

#userSearchInput {
    width: 100%;
    padding: 15px 20px;
    border: 2px solid rgba(255, 215, 0, 0.2);
    background: rgba(0, 0, 0, 0.4);
    color: #fff;
    border-radius: 12px;
    font-size: 1rem;
    margin-bottom: 15px;
    outline: none;
}

#userSearchInput:focus {
    border-color: var(--gold-primary);
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
}

.role-filter-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.role-filter-btn {
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: rgba(255, 255, 255, 0.7);
    border-radius: 20px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all 0.3s;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.role-filter-btn.active,
.role-filter-btn:hover {
    color: #1a0b2e;
    border-color: var(--gold-primary);
    background: var(--gold-primary);
}

.user-list-container {
    max-height: 500px;
    overflow-y: auto;
    padding-right: 10px;
}

.user-list-container::-webkit-scrollbar {
    width: 8px;
}

.user-list-container::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
}

.user-list-container::-webkit-scrollbar-thumb {
    background: var(--gold-primary);
    border-radius: 4px;
}

.user-card {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s;
}

.user-card:hover {
    transform: translateX(5px);
    border-color: rgba(255, 215, 0, 0.3);
}

.user-info-section {
    flex: 1;
}

.user-name {
    font-size: 1.2rem;
    font-weight: 600;
    color: #fff;
    margin-bottom: 5px;
}

.user-details {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.6);
}

.user-roles-section {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
}

.role-tag {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    cursor: pointer;
    transition: all 0.3s;
    border: 2px solid transparent;
}

.role-tag.buyer {
    background: rgba(255, 152, 0, 0.2);
    color: #ff9800;
    border-color: #ff9800;
}

.role-tag.buyer:hover,
.role-tag.buyer.active {
    background: #ff9800;
    color: #1a0b2e;
}

.role-tag.massive {
    background: rgba(76, 175, 80, 0.2);
    color: #4caf50;
    border-color: #4caf50;
}

.role-tag.massive:hover,
.role-tag.massive.active {
    background: #4caf50;
    color: #1a0b2e;
}

.role-tag.rich {
    background: rgba(233, 30, 99, 0.2);
    color: #e91e63;
    border-color: #e91e63;
}

.role-tag.rich:hover,
.role-tag.rich.active {
    background: #e91e63;
    color: #1a0b2e;
}

.role-tag.friend {
    background: rgba(156, 39, 176, 0.2);
    color: #9c27b0;
    border-color: #9c27b0;
}

.role-tag.friend:hover,
.role-tag.friend.active {
    background: #9c27b0;
    color: #1a0b2e;
}

.role-tag.disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

.no-users-found {
    text-align: center;
    padding: 40px;
    color: rgba(255, 255, 255, 0.5);
}

.no-users-found-icon {
    font-size: 3rem;
    margin-bottom: 15px;
    opacity: 0.5;
}
</style>

<!-- Add the JavaScript functionality -->
<script>
// Role management data structure
let userRoles = JSON.parse(localStorage.getItem('tavernUserRoles')) || {};
let allUsers = JSON.parse(localStorage.getItem('tavernAllUsers')) || [];

// Add to the login function to track users
function login() {
    // ... existing login code ...
    
    // Track the user
    if (currentUser && !allUsers.includes(currentUser)) {
        allUsers.push(currentUser);
        localStorage.setItem('tavernAllUsers', JSON.stringify(allUsers));
    }
    
    // ... rest of login code ...
}

// Toggle role panel visibility
function toggleRolePanel() {
    const panel = document.getElementById('roleManagerPanel');
    if (panel.style.display === 'none' || !panel.style.display) {
        panel.style.display = 'block';
        renderUserList();
    } else {
        panel.style.display = 'none';
    }
}

// Render user list with roles
function renderUserList(filter = 'all', searchTerm = '') {
    const container = document.getElementById('userListContainer');
    let filteredUsers = [...allUsers];
    
    // Apply search filter
    if (searchTerm) {
        filteredUsers = filteredUsers.filter(user => 
            user.toLowerCase().includes(searchTerm.toLowerCase())
        );
    }
    
    // Apply role filter
    if (filter !== 'all') {
        filteredUsers = filteredUsers.filter(user => {
            const roles = userRoles[user] || [];
            switch(filter) {
                case 'buyer': return roles.includes('buyer');
                case 'massive': return roles.includes('massive');
                case 'rich': return roles.includes('rich');
                case 'friend': return roles.includes('friend');
                default: return true;
            }
        });
    }
    
    if (!filteredUsers.length) {
        container.innerHTML = `
            <div class="no-users-found">
                <div class="no-users-found-icon">ðŸ‘¤</div>
                <p>${searchTerm ? 'No users match your search' : 'No users found'}</p>
            </div>`;
        return;
    }
    
    container.innerHTML = filteredUsers.map(user => {
        const userDiscord = localStorage.getItem(`tavernDiscord_${user}`) || 'N/A';
        const userMinecraft = localStorage.getItem(`tavernMinecraft_${user}`) || 'N/A';
        const roles = userRoles[user] || [];
        
        return `
            <div class="user-card" data-username="${user}">
                <div class="user-info-section">
                    <div class="user-name">${user}</div>
                    <div class="user-details">Discord: ${userDiscord} | MC: ${userMinecraft}</div>
                </div>
                <div class="user-roles-section">
                    <div class="role-tag buyer ${roles.includes('buyer') ? 'active' : ''}" 
                         onclick="toggleUserRole('${user}', 'buyer')"
                         title="[Buyer] - Orange">
                        Buyer
                    </div>
                    <div class="role-tag massive ${roles.includes('massive') ? 'active' : ''}" 
                         onclick="toggleUserRole('${user}', 'massive')"
                         title="[Massive Buyer] - Green">
                        Massive
                    </div>
                    <div class="role-tag rich ${roles.includes('rich') ? 'active' : ''}" 
                         onclick="toggleUserRole('${user}', 'rich')"
                         title="[ðŸ¤‘Really Rich] - Pink">
                        ðŸ¤‘ Rich
                    </div>
                    <div class="role-tag friend ${roles.includes('friend') ? 'active' : ''}" 
                         onclick="toggleUserRole('${user}', 'friend')"
                         title="[Friend] - Purple">
                        Friend
                    </div>
                </div>
            </div>`;
    }).join('');
}

// Toggle user role
function toggleUserRole(username, role) {
    if (currentUser !== 'FJ121') return;
    
    if (!userRoles[username]) userRoles[username] = [];
    
    const roles = userRoles[username];
    const index = roles.indexOf(role);
    
    if (index > -1) {
        // Remove role
        roles.splice(index, 1);
        showToast(`Removed ${role} role from ${username}`, 'success');
    } else {
        // Add role
        roles.push(role);
        showToast(`Added ${role} role to ${username}`, 'success');
    }
    
    localStorage.setItem('tavernUserRoles', JSON.stringify(userRoles));
    renderUserList();
    
    // Update displayed roles in chat if user is currently viewing
    updateUserDisplayRoles(username);
}

// Search users
function searchUsers() {
    const searchTerm = document.getElementById('userSearchInput').value;
    const activeFilter = document.querySelector('.role-filter-btn.active').dataset.filter || 'all';
    renderUserList(activeFilter, searchTerm);
}

// Filter by role
function filterRole(role) {
    // Update active button
    document.querySelectorAll('.role-filter-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    const searchTerm = document.getElementById('userSearchInput').value;
    renderUserList(role, searchTerm);
}

// Update user display roles (for chat and other areas)
function updateUserDisplayRoles(username) {
    // This can be extended to update chat displays, etc.
    // For now, just re-render if the user is in the current view
    if (document.getElementById('roleManagerPanel').style.display === 'block') {
        renderUserList();
    }
}

// Get user roles for display
function getUserRoles(username) {
    const roles = userRoles[username] || [];
    return roles.map(role => {
        switch(role) {
            case 'buyer': return { tag: '[Buyer]', color: '#ff9800' };
            case 'massive': return { tag: '[Massive Buyer]', color: '#4caf50' };
            case 'rich': return { tag: '[ðŸ¤‘Really Rich]', color: '#e91e63' };
            case 'friend': return { tag: '[Friend]', color: '#9c27b0' };
            default: return null;
        }
    }).filter(Boolean);
}

// Store Discord and Minecraft info per user
// Modify the login function to store this info
const originalLogin = login;
login = function() {
    const result = originalLogin.call(this);
    if (currentUser) {
        localStorage.setItem(`tavernDiscord_${currentUser}`, userDiscord);
        localStorage.setItem(`tavernMinecraft_${currentUser}`, userMinecraft);
    }
    return result;
};

// Initialize role panel
document.addEventListener('DOMContentLoaded', function() {
    // Add data-filter attributes to filter buttons
    const filterButtons = document.querySelectorAll('.role-filter-btn');
    filterButtons.forEach(btn => {
        if (btn.textContent === 'All Users') btn.dataset.filter = 'all';
        else if (btn.textContent === 'Buyers') btn.dataset.filter = 'buyer';
        else if (btn.textContent === 'Massive Buyers') btn.dataset.filter = 'massive';
        else if (btn.textContent === 'Really Rich') btn.dataset.filter = 'rich';
        else if (btn.textContent === 'Friends') btn.dataset.filter = 'friend';
    });
});
</script>
